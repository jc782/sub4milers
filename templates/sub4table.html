{% extends 'base.html' %}
{% load static %}

{% block title %}Chronological Sub-4 Milers{% endblock %}

{% block content %}

<style>
  .search-wrap {
    position: relative;
    margin-bottom: 28px;
    max-width: 480px;
  }
  .search-wrap svg {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--subtle);
    pointer-events: none;
    width: 16px;
    height: 16px;
  }
  .search-input {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: .82rem;
    padding: 12px 16px 12px 42px;
    border-radius: 6px;
    outline: none;
    transition: border-color .2s, box-shadow .2s;
    letter-spacing: .04em;
  }
  .search-input::placeholder { color: var(--muted); }
  .search-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(200,241,53,.08);
  }

  .table-meta {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
    flex-wrap: wrap;
    gap: 8px;
  }
  .view-label {
    font-family: 'DM Mono', monospace;
    font-size: .68rem;
    letter-spacing: .18em;
    text-transform: uppercase;
    color: var(--subtle);
  }
  .row-count {
    font-family: 'DM Mono', monospace;
    font-size: .68rem;
    color: var(--muted);
  }
  #row-count-num { color: var(--accent); }

  .date-unknown {
    color: var(--muted);
    font-style: italic;
    font-size: .78rem;
  }

  .table-wrap {
    overflow-x: auto;
    border: 1px solid var(--border);
    border-radius: 8px;
  }

  table#list {
    width: 100%;
    border-collapse: collapse;
    font-size: 1rem;
  }
  table#list thead tr {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
  }
  table#list thead th {
    font-family: 'DM Mono', monospace;
    font-size: .65rem;
    letter-spacing: .18em;
    text-transform: uppercase;
    color: var(--subtle);
    font-weight: 400;
    padding: 14px 16px;
    text-align: left;
    white-space: nowrap;
  }
  table#list thead th:first-child { width: 56px; text-align: center; }

  table#list tbody tr {
    border-bottom: 1px solid rgba(30,30,46,.7);
    transition: background .15s;
    animation: fadeUp .3s ease both;
  }
  table#list tbody tr:nth-child(1)  { animation-delay: .04s; }
  table#list tbody tr:nth-child(2)  { animation-delay: .07s; }
  table#list tbody tr:nth-child(3)  { animation-delay: .10s; }
  table#list tbody tr:nth-child(4)  { animation-delay: .13s; }
  table#list tbody tr:nth-child(5)  { animation-delay: .16s; }
  table#list tbody tr:nth-child(n+6){ animation-delay: .19s; }
  table#list tbody tr:last-child { border-bottom: none; }
  table#list tbody tr:hover { background: rgba(200,241,53,.035); }
  table#list tbody tr:nth-child(even) { background: rgba(255,255,255,.012); }
  table#list tbody tr:nth-child(even):hover { background: rgba(200,241,53,.04); }
  table#list tbody td { padding: 13px 16px; vertical-align: middle; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .col-rank    { text-align: center; font-family: 'DM Mono', monospace; font-size: .72rem; color: var(--muted); width: 56px; }
  .col-name    { font-weight: 500; color: var(--bright); letter-spacing: .01em; }
  .col-time    { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; letter-spacing: .06em; color: var(--accent); }
  .col-pb      { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; letter-spacing: .06em; color: var(--subtle); }
  .col-date    { font-family: 'DM Mono', monospace; font-size: .82rem; color: var(--subtle); white-space: nowrap; }
  .col-country { font-size: 1.2rem; letter-spacing: .02em; }

  @media (max-width: 768px) { .hide-mobile { display: none; } }
</style>

<div class="table-meta">
  <span class="view-label">ðŸ“… Ranked Chronologically â€” First Sub-4</span>
  <span class="row-count">Showing <span id="row-count-num">â€”</span> athletes</span>
</div>

<div class="search-wrap">
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
    <circle cx="11" cy="11" r="8"/><path stroke-linecap="round" d="m21 21-4.35-4.35"/>
  </svg>
  <input type="text" class="search-input" id="tableSearch" placeholder="Search athletes, countriesâ€¦" autocomplete="off">
</div>

<div class="table-wrap">
  <table id="list">
    <thead>
      <tr>
        <th>#</th>
        <th>Athlete</th>
        <th>First Sub-4</th>
        <th>Date</th>
        <th class="hide-mobile">Best Time</th>
        <th class="hide-mobile">Country</th>
      </tr>
    </thead>
    <tbody>
      {% for sub4 in athletes %}
      <tr>
        <td class="col-rank">{{ forloop.counter }}</td>
        <td class="col-name">{{ sub4.name | title }}</td>
        <td class="col-time">{{ sub4.firstTime | time:"i:s" }}:{{ sub4.firstTime|time:'u'|add:'0'|stringformat:'06i'|slice:':2' }}</td>
        <td class="col-date">{% if sub4.firstDate %}{{ sub4.firstDate }}{% else %}<span class="date-unknown">unknown</span>{% endif %}</td>
        <td class="col-pb hide-mobile">{{ sub4.bestTime | time:"i:s" }}:{{ sub4.bestTime|time:'u'|add:'0'|stringformat:'06i'|slice:':2' }}</td>
        <td class="col-country hide-mobile" data-country="{{ sub4.countries | title }}"></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  const FLAGS = {
    "Alg":"ðŸ‡©ðŸ‡¿","Ang":"ðŸ‡¦ðŸ‡´","Ben":"ðŸ‡§ðŸ‡¯","Bot":"ðŸ‡§ðŸ‡¼","Bdi":"ðŸ‡§ðŸ‡®","Cmr":"ðŸ‡¨ðŸ‡²","Cpv":"ðŸ‡¨ðŸ‡»","Caf":"ðŸ‡¨ðŸ‡«","Cha":"ðŸ‡¹ðŸ‡©","Com":"ðŸ‡°ðŸ‡²",
    "Cgo":"ðŸ‡¨ðŸ‡¬","Cod":"ðŸ‡¨ðŸ‡©","Dji":"ðŸ‡©ðŸ‡¯","Egy":"ðŸ‡ªðŸ‡¬","Gnq":"ðŸ‡¬ðŸ‡¶","Eri":"ðŸ‡ªðŸ‡·","Swz":"ðŸ‡¸ðŸ‡¿","Eth":"ðŸ‡ªðŸ‡¹","Gab":"ðŸ‡¬ðŸ‡¦","Gam":"ðŸ‡¬ðŸ‡²",
    "Gha":"ðŸ‡¬ðŸ‡­","Gui":"ðŸ‡¬ðŸ‡³","Gnb":"ðŸ‡¬ðŸ‡¼","Civ":"ðŸ‡¨ðŸ‡®","Ken":"ðŸ‡°ðŸ‡ª","Les":"ðŸ‡±ðŸ‡¸","Lbr":"ðŸ‡±ðŸ‡·","Lba":"ðŸ‡±ðŸ‡¾","Mad":"ðŸ‡²ðŸ‡¬","Maw":"ðŸ‡²ðŸ‡¼",
    "Mli":"ðŸ‡²ðŸ‡±","Mtn":"ðŸ‡²ðŸ‡·","Mri":"ðŸ‡²ðŸ‡º","Mar":"ðŸ‡²ðŸ‡¦","Moz":"ðŸ‡²ðŸ‡¿","Nam":"ðŸ‡³ðŸ‡¦","Nig":"ðŸ‡³ðŸ‡ª","Ngr":"ðŸ‡³ðŸ‡¬","Reu":"ðŸ‡·ðŸ‡ª","Rwa":"ðŸ‡·ðŸ‡¼",
    "Stp":"ðŸ‡¸ðŸ‡¹","Sen":"ðŸ‡¸ðŸ‡³","Sey":"ðŸ‡¸ðŸ‡¨","Sle":"ðŸ‡¸ðŸ‡±","Som":"ðŸ‡¸ðŸ‡´","Rsa":"ðŸ‡¿ðŸ‡¦","Sud":"ðŸ‡¸ðŸ‡©","Ssd":"ðŸ‡¸ðŸ‡¸","Tan":"ðŸ‡¹ðŸ‡¿","Tog":"ðŸ‡¹ðŸ‡¬",
    "Tun":"ðŸ‡¹ðŸ‡³","Uga":"ðŸ‡ºðŸ‡¬","Zam":"ðŸ‡¿ðŸ‡²","Zim":"ðŸ‡¿ðŸ‡¼",
    "Ant":"ðŸ‡¦ðŸ‡¬","Arg":"ðŸ‡¦ðŸ‡·","Arb":"ðŸ‡¦ðŸ‡¼","Bah":"ðŸ‡§ðŸ‡¸","Bar":"ðŸ‡§ðŸ‡§","Blz":"ðŸ‡§ðŸ‡¿","Ber":"ðŸ‡§ðŸ‡²","Bol":"ðŸ‡§ðŸ‡´","Bra":"ðŸ‡§ðŸ‡·","Ivb":"ðŸ‡»ðŸ‡¬",
    "Can":"ðŸ‡¨ðŸ‡¦","Cay":"ðŸ‡°ðŸ‡¾","Chi":"ðŸ‡¨ðŸ‡±","Col":"ðŸ‡¨ðŸ‡´","Crc":"ðŸ‡¨ðŸ‡·","Cub":"ðŸ‡¨ðŸ‡º","Dom":"ðŸ‡©ðŸ‡´","Ecu":"ðŸ‡ªðŸ‡¨","Slv":"ðŸ‡¸ðŸ‡»","Grd":"ðŸ‡¬ðŸ‡©",
    "Gtm":"ðŸ‡¬ðŸ‡¹","Gua":"ðŸ‡¬ðŸ‡¹","Guy":"ðŸ‡¬ðŸ‡¾","Hai":"ðŸ‡­ðŸ‡¹","Hon":"ðŸ‡­ðŸ‡³","Jam":"ðŸ‡¯ðŸ‡²","Mex":"ðŸ‡²ðŸ‡½","Nca":"ðŸ‡³ðŸ‡®","Pan":"ðŸ‡µðŸ‡¦","Par":"ðŸ‡µðŸ‡¾",
    "Per":"ðŸ‡µðŸ‡ª","Pto":"ðŸ‡µðŸ‡·","Skn":"ðŸ‡°ðŸ‡³","Lca":"ðŸ‡±ðŸ‡¨","Vin":"ðŸ‡»ðŸ‡¨","Sur":"ðŸ‡¸ðŸ‡·","Tto":"ðŸ‡¹ðŸ‡¹","Uru":"ðŸ‡ºðŸ‡¾","Usa":"ðŸ‡ºðŸ‡¸","Ven":"ðŸ‡»ðŸ‡ª","Isv":"ðŸ‡»ðŸ‡®",
    "Afg":"ðŸ‡¦ðŸ‡«","Brn":"ðŸ‡§ðŸ‡­","Ban":"ðŸ‡§ðŸ‡©","Btn":"ðŸ‡§ðŸ‡¹","Bru":"ðŸ‡§ðŸ‡³","Cam":"ðŸ‡°ðŸ‡­","Chn":"ðŸ‡¨ðŸ‡³","Hkg":"ðŸ‡­ðŸ‡°","Ind":"ðŸ‡®ðŸ‡³","Ina":"ðŸ‡®ðŸ‡©",
    "Iri":"ðŸ‡®ðŸ‡·","Irq":"ðŸ‡®ðŸ‡¶","Isr":"ðŸ‡®ðŸ‡±","Jpn":"ðŸ‡¯ðŸ‡µ","Jor":"ðŸ‡¯ðŸ‡´","Kaz":"ðŸ‡°ðŸ‡¿","Prk":"ðŸ‡°ðŸ‡µ","Kor":"ðŸ‡°ðŸ‡·","Kuw":"ðŸ‡°ðŸ‡¼","Kgz":"ðŸ‡°ðŸ‡¬",
    "Lao":"ðŸ‡±ðŸ‡¦","Lbn":"ðŸ‡±ðŸ‡§","Mac":"ðŸ‡²ðŸ‡´","Mas":"ðŸ‡²ðŸ‡¾","Mdv":"ðŸ‡²ðŸ‡»","Mgl":"ðŸ‡²ðŸ‡³","Mya":"ðŸ‡²ðŸ‡²","Nep":"ðŸ‡³ðŸ‡µ","Oma":"ðŸ‡´ðŸ‡²","Pak":"ðŸ‡µðŸ‡°",
    "Phi":"ðŸ‡µðŸ‡­","Qat":"ðŸ‡¶ðŸ‡¦","Ksa":"ðŸ‡¸ðŸ‡¦","Sin":"ðŸ‡¸ðŸ‡¬","Sri":"ðŸ‡±ðŸ‡°","Syr":"ðŸ‡¸ðŸ‡¾","Tpe":"ðŸ‡¹ðŸ‡¼","Tjk":"ðŸ‡¹ðŸ‡¯","Tha":"ðŸ‡¹ðŸ‡­","Tkm":"ðŸ‡¹ðŸ‡²",
    "Uae":"ðŸ‡¦ðŸ‡ª","Uzb":"ðŸ‡ºðŸ‡¿","Vie":"ðŸ‡»ðŸ‡³","Yem":"ðŸ‡¾ðŸ‡ª",
    "Alb":"ðŸ‡¦ðŸ‡±","And":"ðŸ‡¦ðŸ‡©","Arm":"ðŸ‡¦ðŸ‡²","Aut":"ðŸ‡¦ðŸ‡¹","Aze":"ðŸ‡¦ðŸ‡¿","Blr":"ðŸ‡§ðŸ‡¾","Bel":"ðŸ‡§ðŸ‡ª","Bih":"ðŸ‡§ðŸ‡¦","Bul":"ðŸ‡§ðŸ‡¬","Cro":"ðŸ‡­ðŸ‡·",
    "Cyp":"ðŸ‡¨ðŸ‡¾","Cze":"ðŸ‡¨ðŸ‡¿","Den":"ðŸ‡©ðŸ‡°","Est":"ðŸ‡ªðŸ‡ª","Fin":"ðŸ‡«ðŸ‡®","Fra":"ðŸ‡«ðŸ‡·","Geo":"ðŸ‡¬ðŸ‡ª","Ger":"ðŸ‡©ðŸ‡ª","Gbr":"ðŸ‡¬ðŸ‡§","Gre":"ðŸ‡¬ðŸ‡·",
    "Hun":"ðŸ‡­ðŸ‡º","Isl":"ðŸ‡®ðŸ‡¸","Irl":"ðŸ‡®ðŸ‡ª","Ita":"ðŸ‡®ðŸ‡¹","Kos":"ðŸ‡½ðŸ‡°","Lat":"ðŸ‡±ðŸ‡»","Lie":"ðŸ‡±ðŸ‡®","Ltu":"ðŸ‡±ðŸ‡¹","Lux":"ðŸ‡±ðŸ‡º","Mkd":"ðŸ‡²ðŸ‡°",
    "Mlt":"ðŸ‡²ðŸ‡¹","Mda":"ðŸ‡²ðŸ‡©","Mon":"ðŸ‡²ðŸ‡¨","Mne":"ðŸ‡²ðŸ‡ª","Ned":"ðŸ‡³ðŸ‡±","Nor":"ðŸ‡³ðŸ‡´","Pol":"ðŸ‡µðŸ‡±","Por":"ðŸ‡µðŸ‡¹","Rom":"ðŸ‡·ðŸ‡´","Rou":"ðŸ‡·ðŸ‡´",
    "Rus":"ðŸ‡·ðŸ‡º","Smr":"ðŸ‡¸ðŸ‡²","Srb":"ðŸ‡·ðŸ‡¸","Svk":"ðŸ‡¸ðŸ‡°","Slo":"ðŸ‡¸ðŸ‡®","Esp":"ðŸ‡ªðŸ‡¸","Swe":"ðŸ‡¸ðŸ‡ª","Sui":"ðŸ‡¨ðŸ‡­","Tur":"ðŸ‡¹ðŸ‡·","Ukr":"ðŸ‡ºðŸ‡¦",
    "Aus":"ðŸ‡¦ðŸ‡º","Nzl":"ðŸ‡³ðŸ‡¿","Png":"ðŸ‡µðŸ‡¬","Fij":"ðŸ‡«ðŸ‡¯","Sam":"ðŸ‡¼ðŸ‡¸","Sol":"ðŸ‡¸ðŸ‡§","Van":"ðŸ‡»ðŸ‡º",
    "Frg":"ðŸ‡©ðŸ‡ª","Gdr":"ðŸ‡©ðŸ‡ª","Urs":"ðŸ‡·ðŸ‡º","Yug":"ðŸ‡·ðŸ‡¸","Tch":"ðŸ‡¨ðŸ‡¿","Ana":"ðŸ‡·ðŸ‡¸","Scg":"ðŸ‡·ðŸ‡¸","Roc":"ðŸ‡·ðŸ‡º",
  };

  function getFlag(raw) {
    if (!raw || raw.trim() === '' || raw.trim().toLowerCase() === 'nan') return 'ðŸ³ï¸';
    return raw.split(/[\/,]/).map(p => FLAGS[p.trim()] || 'ðŸ³ï¸').join(' ');
  }

  document.querySelectorAll('.col-country[data-country]').forEach(td => {
    td.innerHTML = getFlag(td.dataset.country);
  });

  const tbody   = document.querySelector('#list tbody');
  const countEl = document.getElementById('row-count-num');
  const heroEl  = document.getElementById('total-count');
  const total   = tbody.querySelectorAll('tr').length;
  countEl.textContent = total.toLocaleString();
  if (heroEl) heroEl.textContent = total.toLocaleString();

  document.getElementById('tableSearch').addEventListener('input', function () {
    const q = this.value.toLowerCase();
    let visible = 0;
    tbody.querySelectorAll('tr').forEach(row => {
      const match = row.textContent.toLowerCase().includes(q);
      row.style.display = match ? '' : 'none';
      if (match) visible++;
    });
    countEl.textContent = visible.toLocaleString();
  });
</script>

{% endblock %}